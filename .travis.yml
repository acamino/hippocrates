dist: bionic
language: ruby
cache:
  bundler: true
rvm:
  - rvm 2.7.4
services:
  - postgresql
addons:
  postgresql: "9.5"

script:
  - bundle exec rubocop
  - RAILS_ENV=test bundle exec rails db:create db:schema:load --trace
  - bundle exec rspec
  - bundle exec cucumber

before_deploy:
  - rvm $(travis_internal_ruby) --fuzzy do ruby -S gem install faraday -v 1.10.0

deploy:
  provider: heroku
  api_key:
    secure: FaZhyDzD7d44nYqzwfQrHcJsyvQXM81yKVP/fjNBssyz6J6AD0w0OpJbZ6VlTCUZuiW97iz+Bbll2ac7+sTdLETpv9AFIL3QYRtPgfyGqxPkdnoN4IE079+su+QE0uvIYjcE0uqs7rEif2jtTJU8+EmfkFk2FSlQn13t7EOVNeziqi062h59MWwmkSHkBsZkc3hjWg3XUy8hHxxoeo1zyBKtorSjFVp+/dIf3X8OGc7TdXAwdaJ4gLk0TZvb8oUOEFBs/bMICib/a208xfhXukfq/sWH185JORuS5LxXOsx/cDlBl6x5SaLmNSjESKvu3BnDkuTe1192y/XrUh2NmI1ZCznPZ9Kz1P7NsD5BZJSpGE/ZeMTdYQ6CVMkmIyIO3FcdvQTo1KbJGw1wK7MSuk/sT6Ziib77xIzNOlzvKiB5IS60yUxf4WMFCMOT26GOLfi6ywqE71LCx647DnFz28Y4mHJqWzARgcn/F/XDVygWHnrHmv2ga7YIXvCIhmCcpbiF3BmTIXWNa74ouaNsMranlsr0YYGoxZSTC7HU/xr1QPSCfijXAvHecqPYBW/nC4IIvItCrTCG3uGm6aL3ucY1ea1aXaJ/lMFGb224CArrprWrPwSwYDolqWwNAMUMXyoz/5DkLlpdnTsy/JkjTWTgy+Qpwd0uhm2tbU39SW0=

  run: bundle exec rake db:migrate
  skip_cleanup: true
  on:
    branch:
      - main
